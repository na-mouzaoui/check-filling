================================================================================
          DOCUMENTATION BACKEND - SYST√àME DE REMPLISSAGE DE CH√àQUES
================================================================================

STRUCTURE G√âN√âRALE
------------------
backend/
‚îú‚îÄ‚îÄ Controllers/          # Contr√¥leurs API (endpoints REST)
‚îú‚îÄ‚îÄ Services/             # Logique m√©tier et traitement des donn√©es
‚îú‚îÄ‚îÄ Models/               # Mod√®les de donn√©es (entit√©s)
‚îú‚îÄ‚îÄ Data/                 # Contexte de base de donn√©es
‚îú‚îÄ‚îÄ Migrations/           # Migrations Entity Framework
‚îú‚îÄ‚îÄ wwwroot/              # Fichiers statiques (PDFs upload√©s)
‚îú‚îÄ‚îÄ bin/                  # Binaires compil√©s (g√©n√©r√© automatiquement)
‚îú‚îÄ‚îÄ obj/                  # Fichiers objets de compilation (g√©n√©r√©)
‚îú‚îÄ‚îÄ Program.cs            # Point d'entr√©e de l'application
‚îú‚îÄ‚îÄ appsettings.json      # Configuration de l'application
‚îú‚îÄ‚îÄ CheckFillingAPI.csproj # Fichier de projet .NET
‚îî‚îÄ‚îÄ README.md             # Documentation du projet


================================================================================
                              FICHIERS PRINCIPAUX
================================================================================

üìÑ Program.cs
-------------
R√îLE : Point d'entr√©e principal de l'API ASP.NET Core
CONTENU :
  - Configuration des services (DbContext, Authentication, CORS)
  - Configuration JWT pour l'authentification
  - Configuration de la base de donn√©es SQL Server
  - Middleware pipeline (CORS, Authentication, Authorization)
  - Initialisation de la base de donn√©es au d√©marrage

SERVICES CONFIGUR√âS :
  ‚úì Entity Framework Core avec SQL Server
  ‚úì JWT Bearer Authentication (lecture depuis cookie HttpOnly)
  ‚úì CORS pour localhost:3000 et localhost:3001
  ‚úì Contr√¥leurs API
  ‚úì Services m√©tier (AuthService, BankService, CheckService)


üìÑ appsettings.json
-------------------
R√îLE : Fichier de configuration de l'application
CONTENU :
  - ConnectionStrings : Cha√Æne de connexion SQL Server
    * DefaultConnection : "Server=localhost;Database=CheckFilling;..."
  - Jwt : Configuration du token JWT
    * Key : Cl√© secr√®te pour signer les tokens
    * Issuer : √âmetteur du token
    * Audience : Audience du token
  - Logging : Configuration des logs


üìÑ CheckFillingAPI.csproj
--------------------------
R√îLE : Fichier de projet .NET d√©finissant les d√©pendances
PACKAGES :
  - Microsoft.EntityFrameworkCore (10.0.1)
  - Microsoft.EntityFrameworkCore.SqlServer (10.0.1)
  - Microsoft.EntityFrameworkCore.Design (10.0.1)
  - Microsoft.AspNetCore.Authentication.JwtBearer (10.0.0)
  - BCrypt.Net-Next (4.0.3) - Hash des mots de passe


================================================================================
                              DOSSIER: Controllers/
================================================================================

Les contr√¥leurs exposent les endpoints de l'API REST. Tous utilisent l'attribut
[ApiController] et [Route("api/[controller]")] pour d√©finir les routes.


üìÑ AuthController.cs
--------------------
ROUTE BASE : /api/auth
R√îLE : Gestion de l'authentification des utilisateurs

ENDPOINTS :
  POST /api/auth/register
    - Inscription d'un nouvel utilisateur
    - Param√®tres : { email, password }
    - Hash le mot de passe avec BCrypt
    - Retourne : utilisateur cr√©√© (sans le hash du mot de passe)

  POST /api/auth/login
    - Connexion d'un utilisateur existant
    - Param√®tres : { email, password }
    - V√©rifie le mot de passe avec BCrypt
    - G√©n√®re un token JWT
    - Stocke le JWT dans un cookie HttpOnly s√©curis√©
    - Retourne : { token, user }

  POST /api/auth/logout
    - D√©connexion de l'utilisateur
    - Supprime le cookie JWT
    - Retourne : message de succ√®s

S√âCURIT√â :
  ‚úì Mots de passe hash√©s avec BCrypt (co√ªt 11)
  ‚úì JWT stock√© dans cookie HttpOnly (protection XSS)
  ‚úì Cookie avec SameSite=Lax et Secure=false (dev local)


üìÑ BanksController.cs
---------------------
ROUTE BASE : /api/banks
R√îLE : Gestion des banques et leurs mod√®les de ch√®ques
AUTHENTIFICATION : Requise sur tous les endpoints ([Authorize])

ENDPOINTS :
  GET /api/banks
    - Liste toutes les banques
    - Retourne : tableau de banques avec leurs positions

  GET /api/banks/{id}
    - D√©tails d'une banque sp√©cifique
    - Retourne : banque avec positions d√©s√©rialis√©es

  POST /api/banks
    - Cr√©ation d'une nouvelle banque
    - Param√®tres : { code, name, pdfFile? }
    - Upload optionnel d'un PDF de mod√®le de ch√®que
    - Sauvegarde le PDF dans wwwroot/uploads/
    - Retourne : banque cr√©√©e

  PUT /api/banks/{id}
    - Mise √† jour d'une banque existante
    - Peut mettre √† jour : name, code, positions, PDF
    - Retourne : banque mise √† jour

  DELETE /api/banks/{id}
    - Suppression d'une banque
    - Supprime aussi le fichier PDF associ√©
    - Retourne : 204 No Content

FONCTIONNALIT√âS :
  ‚úì Upload de fichiers PDF (mod√®les de ch√®ques)
  ‚úì Stockage des positions de champs en JSON
  ‚úì Gestion des fichiers statiques


üìÑ ChecksController.cs
----------------------
ROUTE BASE : /api/checks
R√îLE : Gestion de l'historique des ch√®ques imprim√©s
AUTHENTIFICATION : Requise sur tous les endpoints ([Authorize])

ENDPOINTS :
  GET /api/checks
    - Liste tous les ch√®ques de l'utilisateur connect√©
    - Filtre automatique par userId du JWT
    - Retourne : tableau de DTOs (sans navigation circulaire)

  GET /api/checks/stats
    - Statistiques pour le dashboard
    - Total des ch√®ques de l'utilisateur
    - Retourne : { totalChecks, ... }

  GET /api/checks/{id}
    - D√©tails d'un ch√®que sp√©cifique
    - V√©rifie l'appartenance √† l'utilisateur connect√©
    - Retourne : DTO du ch√®que

  POST /api/checks
    - Enregistrement d'un nouveau ch√®que imprim√©
    - Param√®tres : { amount, amountInWords, payee, city, date, reference, bank }
    - UserId extrait automatiquement du JWT
    - Retourne : DTO du ch√®que cr√©√©

  PUT /api/checks/{id}
    - Mise √† jour d'un ch√®que (non impl√©ment√© actuellement)

  DELETE /api/checks/{id}
    - Suppression d'un ch√®que de l'historique
    - Retourne : 204 No Content

S√âCURIT√â :
  ‚úì Filtrage automatique par utilisateur (userId du JWT)
  ‚úì V√©rification de propri√©t√© avant modification/suppression
  ‚úì DTOs pour √©viter les r√©f√©rences circulaires JSON


üìÑ UsersController.cs
---------------------
ROUTE BASE : /api/users
R√îLE : Gestion des utilisateurs (admin/stats)
AUTHENTIFICATION : Requise ([Authorize])

ENDPOINTS :
  GET /api/users
    - Liste de tous les utilisateurs (pour dashboard/stats)
    - Retourne : tableau de { id, email, createdAt }
    - Note : Exclut les mots de passe hash√©s


================================================================================
                              DOSSIER: Services/
================================================================================

Les services contiennent la logique m√©tier. Ils sont inject√©s dans les
contr√¥leurs via Dependency Injection.


üìÑ IServices.cs
---------------
R√îLE : Interfaces des services (contrats)

INTERFACES D√âFINIES :

  IAuthService
    - Task<User?> Register(string email, string password)
    - Task<User?> Login(string email, string password)
    - string GenerateJwtToken(User user)

  IBankService
    - Task<IEnumerable<Bank>> GetAllBanks()
    - Task<Bank?> GetBankById(int id)
    - Task<Bank> CreateBank(Bank bank)
    - Task<Bank?> UpdateBank(int id, Bank bank)
    - Task<bool> DeleteBank(int id)

  ICheckService
    - Task<IEnumerable<Check>> GetChecksByUserId(int userId)
    - Task<Check?> GetCheckById(int id, int userId)
    - Task<Check> CreateCheck(Check check)
    - Task<bool> DeleteCheck(int id, int userId)


üìÑ AuthService.cs
-----------------
R√îLE : Impl√©mentation de la logique d'authentification

M√âTHODES :

  Register(email, password)
    - V√©rifie si l'email existe d√©j√†
    - Hash le mot de passe avec BCrypt (WorkFactor: 11)
    - Cr√©e l'utilisateur en base
    - Retourne l'utilisateur cr√©√©

  Login(email, password)
    - Recherche l'utilisateur par email
    - V√©rifie le mot de passe avec BCrypt.Verify
    - Retourne l'utilisateur si valide, null sinon

  GenerateJwtToken(user)
    - Cr√©e un token JWT avec les claims:
      * userId : ID de l'utilisateur
      * email : Email de l'utilisateur
    - Dur√©e de validit√© : 24 heures
    - Sign√© avec la cl√© secr√®te du appsettings.json
    - Retourne le token JWT

D√âPENDANCES :
  - AppDbContext : Acc√®s √† la base de donn√©es
  - IConfiguration : Lecture de la cl√© JWT


üìÑ BankService.cs
-----------------
R√îLE : Gestion des op√©rations CRUD sur les banques

M√âTHODES :

  GetAllBanks()
    - R√©cup√®re toutes les banques
    - Retourne la liste compl√®te

  GetBankById(id)
    - Recherche une banque par ID
    - Retourne la banque ou null

  CreateBank(bank)
    - Ajoute une nouvelle banque
    - Sauvegarde en base
    - Retourne la banque cr√©√©e

  UpdateBank(id, bank)
    - Mise √† jour des propri√©t√©s d'une banque
    - Retourne la banque mise √† jour ou null

  DeleteBank(id)
    - Supprime une banque de la base
    - Retourne true si succ√®s, false sinon

D√âPENDANCES :
  - AppDbContext : Acc√®s √† la base de donn√©es


üìÑ CheckService.cs
------------------
R√îLE : Gestion de l'historique des ch√®ques imprim√©s

M√âTHODES :

  GetChecksByUserId(userId)
    - R√©cup√®re tous les ch√®ques d'un utilisateur
    - Tri par date de cr√©ation (plus r√©cent en premier)
    - Inclut les donn√©es de l'utilisateur (navigation)
    - Retourne la liste des ch√®ques

  GetCheckById(id, userId)
    - Recherche un ch√®que par ID
    - V√©rifie qu'il appartient √† l'utilisateur
    - Inclut les donn√©es de l'utilisateur
    - Retourne le ch√®que ou null

  CreateCheck(check)
    - Enregistre un nouveau ch√®que imprim√©
    - Sauvegarde en base avec timestamp
    - Retourne le ch√®que cr√©√©

  DeleteCheck(id, userId)
    - Supprime un ch√®que de l'historique
    - V√©rifie l'appartenance √† l'utilisateur
    - Retourne true si succ√®s, false sinon

D√âPENDANCES :
  - AppDbContext : Acc√®s √† la base de donn√©es


================================================================================
                              DOSSIER: Models/
================================================================================

üìÑ Models.cs
------------
R√îLE : D√©finition des entit√©s de la base de donn√©es

CLASSES :

  User (Utilisateur)
    - Id : int (cl√© primaire)
    - Email : string (unique)
    - PasswordHash : string (hash BCrypt)
    - CreatedAt : DateTime (date de cr√©ation)
    - Checks : ICollection<Check> (navigation vers les ch√®ques)

  Check (Ch√®que imprim√©)
    - Id : int (cl√© primaire)
    - UserId : int (cl√© √©trang√®re vers User)
    - Amount : decimal (montant num√©rique)
    - AmountInWords : string (montant en lettres)
    - Payee : string (b√©n√©ficiaire)
    - City : string (ville)
    - Date : string (date du ch√®que)
    - Reference : string (r√©f√©rence optionnelle)
    - Bank : string (nom de la banque)
    - CreatedAt : DateTime (date d'enregistrement)
    - User : User (navigation vers l'utilisateur)

  Bank (Banque)
    - Id : int (cl√© primaire)
    - Code : string (code unique de la banque)
    - Name : string (nom complet)
    - PdfUrl : string? (chemin vers le PDF mod√®le, nullable)
    - PositionsJson : string (positions des champs en JSON)
    - CreatedAt : DateTime (date de cr√©ation)

  BankPositions (Positions des champs sur le ch√®que)
    - City : FieldPosition (position du champ ville)
    - Date : FieldPosition (position de la date)
    - Payee : FieldPosition (position du b√©n√©ficiaire)
    - AmountInWords : FieldPosition (montant en lettres ligne 1)
    - AmountInWordsLine2 : FieldPosition? (ligne 2, optionnel)
    - Amount : FieldPosition (montant num√©rique)

  FieldPosition (Position d'un champ)
    - X : int (position horizontale en pixels)
    - Y : int (position verticale en pixels)
    - Width : int (largeur du champ)
    - FontSize : int (taille de police)

RELATIONS :
  - User 1 ‚Üí N Check (un utilisateur a plusieurs ch√®ques)
  - Bank n'a pas de relation avec Check (stockage du nom uniquement)


================================================================================
                              DOSSIER: Data/
================================================================================

üìÑ AppDbContext.cs
------------------
R√îLE : Contexte Entity Framework Core - Interface avec la base de donn√©es

RESPONSABILIT√âS :
  - D√©finit les DbSet (tables) : Users, Checks, Banks
  - Configure les relations entre entit√©s
  - D√©finit les index de base de donn√©es
  - Configure le seeding (donn√©es initiales)

CONFIGURATION DES ENTIT√âS :

  User :
    - Email unique (index)
    - PasswordHash requis
    - Relation 1-N vers Checks (cascade delete)

  Check :
    - UserId requis (cl√© √©trang√®re)
    - Index sur UserId pour performance
    - Relation N-1 vers User

  Bank :
    - Code unique (index)
    - Name requis
    - PositionsJson avec valeur par d√©faut "{}"

DONN√âES DE SEED (initiales) :
  ‚úì 1 utilisateur test :
    - Email: test@gmail.com
    - Mot de passe: test1234 (hash BCrypt statique)
    - Cr√©√© le: 2025-01-01

  ‚úì 3 banques alg√©riennes :
    - BNA (Banque Nationale d'Alg√©rie) - Code: BNA
    - CPA (Cr√©dit Populaire d'Alg√©rie) - Code: CPA  
    - BEA (Banque Ext√©rieure d'Alg√©rie) - Code: BEA

Note : Le seed utilise des valeurs d√©terministes (date et hash fixes)
       pour permettre des migrations reproductibles.


================================================================================
                              DOSSIER: Migrations/
================================================================================

R√îLE : Historique des modifications de sch√©ma de base de donn√©es

FICHIERS G√âN√âR√âS AUTOMATIQUEMENT :
  - *_InitialCreate.cs : Migration initiale (cr√©ation des tables)
  - *.Designer.cs : M√©tadonn√©es du mod√®le
  - AppDbContextModelSnapshot.cs : Snapshot actuel du mod√®le

COMMANDES UTILES :
  Cr√©er une migration :
    dotnet ef migrations add NomDeLaMigration

  Appliquer les migrations :
    dotnet ef database update

  Annuler la derni√®re migration :
    dotnet ef migrations remove

  R√©initialiser la base :
    DROP DATABASE CheckFilling
    dotnet ef database update


================================================================================
                              DOSSIER: wwwroot/
================================================================================

R√îLE : Fichiers statiques accessibles via HTTP

STRUCTURE :
  wwwroot/
  ‚îî‚îÄ‚îÄ uploads/
      ‚îî‚îÄ‚îÄ [fichiers PDF des mod√®les de ch√®ques]

USAGE :
  - Les PDFs upload√©s pour les banques sont stock√©s ici
  - Accessibles via : http://localhost:5000/uploads/nom_fichier.pdf
  - Configuration dans Program.cs : app.UseStaticFiles()

S√âCURIT√â :
  - Pas de listage de r√©pertoire activ√©
  - Seuls les fichiers explicitement upload√©s sont accessibles


================================================================================
                                   S√âCURIT√â
================================================================================

AUTHENTIFICATION :
  ‚úì JWT Bearer Token
  ‚úì Token stock√© dans cookie HttpOnly (protection XSS)
  ‚úì Dur√©e de vie : 24 heures
  ‚úì Lecture du token depuis cookie ET header Authorization

MOTS DE PASSE :
  ‚úì Hash avec BCrypt
  ‚úì Work Factor : 11 (2^11 it√©rations)
  ‚úì Salt unique par mot de passe (automatique avec BCrypt)

CORS :
  ‚úì Activ√© pour localhost:3000 et localhost:3001
  ‚úì Credentials autoris√©s (cookies)
  ‚úì Tous les headers et m√©thodes autoris√©s

BASE DE DONN√âES :
  ‚úì SQL Server avec Windows Authentication
  ‚úì TrustServerCertificate=True (dev local)
  ‚úì Param√®tres param√©tr√©s (protection injection SQL via EF Core)

AUTORISATIONS :
  ‚úì [Authorize] sur les endpoints prot√©g√©s
  ‚úì Filtrage automatique par userId (extraction du JWT)
  ‚úì V√©rification de propri√©t√© avant modification/suppression


================================================================================
                              FLUX DE DONN√âES
================================================================================

1. INSCRIPTION/CONNEXION :
   Frontend ‚Üí POST /api/auth/register ou /login
   ‚Üí AuthController ‚Üí AuthService
   ‚Üí V√©rification/Hash BCrypt ‚Üí DbContext ‚Üí SQL Server
   ‚Üí G√©n√©ration JWT ‚Üí Cookie HttpOnly ‚Üí Frontend

2. GESTION DES BANQUES :
   Frontend (auth) ‚Üí /api/banks (GET/POST/PUT/DELETE)
   ‚Üí BanksController (v√©rifie JWT) ‚Üí BankService
   ‚Üí DbContext ‚Üí SQL Server
   ‚Üí Retour JSON ‚Üí Frontend

3. ENREGISTREMENT D'UN CH√àQUE :
   Frontend (apr√®s impression) ‚Üí POST /api/checks
   ‚Üí ChecksController (extrait userId du JWT) ‚Üí CheckService
   ‚Üí DbContext ‚Üí SQL Server (table Checks)
   ‚Üí Retour DTO ‚Üí Frontend (historique)

4. CONSULTATION HISTORIQUE :
   Frontend ‚Üí GET /api/checks
   ‚Üí ChecksController (filtre par userId) ‚Üí CheckService
   ‚Üí DbContext ‚Üí SQL Server ‚Üí Retour DTOs ‚Üí Frontend


================================================================================
                           TECHNOLOGIES UTILIS√âES
================================================================================

‚úì .NET 10.0 (derni√®re version LTS)
‚úì ASP.NET Core 10.0 (framework web)
‚úì Entity Framework Core 10.0.1 (ORM)
‚úì SQL Server (base de donn√©es)
‚úì BCrypt.Net-Next 4.0.3 (hash de mots de passe)
‚úì JWT Bearer Authentication (authentification stateless)


================================================================================
                              POINTS D'ATTENTION
================================================================================

‚ö†Ô∏è CONFIGURATION REQUISE :
  - SQL Server doit √™tre install√© et d√©marr√© sur localhost
  - La base de donn√©es "CheckFilling" est cr√©√©e automatiquement
  - La cl√© JWT doit √™tre pr√©sente dans appsettings.json

‚ö†Ô∏è D√âVELOPPEMENT :
  - Port par d√©faut : 5000
  - HTTPS d√©sactiv√© en dev (RequireHttpsMetadata = false)
  - Cookie Secure = false (d√©veloppement local)

‚ö†Ô∏è PRODUCTION :
  - Activer HTTPS
  - Mettre Secure = true sur les cookies
  - Changer la cl√© JWT
  - Configurer un serveur SQL distant si n√©cessaire
  - Activer les logs appropri√©s


================================================================================
                           COMMANDES UTILES
================================================================================

Lancer l'API :
  cd backend
  dotnet run

Build de production :
  dotnet publish -c Release

Cr√©er une migration :
  dotnet ef migrations add NomMigration

Appliquer les migrations :
  dotnet ef database update

Lister les migrations :
  dotnet ef migrations list

Restaurer les packages :
  dotnet restore

Tests (si impl√©ment√©s) :
  dotnet test


================================================================================
Derni√®re mise √† jour : 31 d√©cembre 2025
================================================================================
